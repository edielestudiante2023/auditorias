# ============================================================
# Apache VirtualHost Configuration for Cycloid Auditor√≠as
# ============================================================
#
# Installation Instructions:
# --------------------------
# 1. Copy this file to Apache config directory:
#    - Linux: /etc/apache2/sites-available/auditorias.conf
#    - Windows (XAMPP): C:\xampp\apache\conf\extra\httpd-vhosts.conf (append at end)
#    - macOS (MAMP): /Applications/MAMP/conf/apache/extra/httpd-vhosts.conf
#
# 2. Update paths and domain below to match your setup
#
# 3. Enable required modules (Linux):
#    sudo a2enmod rewrite
#    sudo a2ensite auditorias.conf
#    sudo systemctl reload apache2
#
# 4. Add to hosts file if using local domain:
#    127.0.0.1  auditorias.local
#
# 5. Verify: curl http://auditorias.local/health
# ============================================================

<VirtualHost *:80>
    # Domain configuration
    ServerName auditorias.local
    ServerAlias www.auditorias.local
    ServerAdmin admin@cycloidtalent.com

    # Point DocumentRoot to the public folder
    DocumentRoot "C:/xampp/htdocs/auditorias/public"

    # Directory permissions and rewrite rules
    <Directory "C:/xampp/htdocs/auditorias/public">
        # Allow .htaccess overrides
        AllowOverride All

        # Grant access
        Require all granted

        # Enable rewrite engine
        Options -Indexes +FollowSymLinks

        # Force HTTPS (uncomment for production)
        # RewriteEngine On
        # RewriteCond %{HTTPS} off
        # RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
    </Directory>

    # ========================================
    # SECURITY: Deny access to sensitive directories
    # ========================================

    # Deny access to app/ directory
    <Directory "C:/xampp/htdocs/auditorias/app">
        Require all denied
    </Directory>

    # Deny access to writable/ directory
    <Directory "C:/xampp/htdocs/auditorias/writable">
        Require all denied
    </Directory>

    # Deny access to vendor/ directory
    <Directory "C:/xampp/htdocs/auditorias/vendor">
        Require all denied
    </Directory>

    # Deny access to .env and other sensitive files
    <FilesMatch "^\.env">
        Require all denied
    </FilesMatch>

    # Deny access to composer files
    <FilesMatch "^composer\.(json|lock)$">
        Require all denied
    </FilesMatch>

    # Deny access to phpunit.xml
    <FilesMatch "^phpunit\.xml$">
        Require all denied
    </FilesMatch>

    # ========================================
    # Performance & Caching
    # ========================================

    # Enable compression (if mod_deflate is enabled)
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
    </IfModule>

    # Browser caching for static assets
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresByType image/jpg "access plus 1 year"
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType image/svg+xml "access plus 1 year"
        ExpiresByType text/css "access plus 1 month"
        ExpiresByType application/javascript "access plus 1 month"
        ExpiresByType application/pdf "access plus 1 month"
        ExpiresByType application/x-shockwave-flash "access plus 1 month"
    </IfModule>

    # ========================================
    # Logging
    # ========================================

    # Error log
    ErrorLog "C:/xampp/apache/logs/auditorias-error.log"

    # Access log
    CustomLog "C:/xampp/apache/logs/auditorias-access.log" combined

    # Log level (options: debug, info, notice, warn, error, crit, alert, emerg)
    LogLevel warn

</VirtualHost>

# ============================================================
# HTTPS VirtualHost (Production - Uncomment and configure)
# ============================================================
#
# <VirtualHost *:443>
#     ServerName auditorias.local
#     ServerAlias www.auditorias.local
#     ServerAdmin admin@cycloidtalent.com
#
#     DocumentRoot "C:/xampp/htdocs/auditorias/public"
#
#     # SSL Configuration
#     SSLEngine on
#     SSLCertificateFile "/path/to/certificate.crt"
#     SSLCertificateKeyFile "/path/to/private.key"
#     SSLCertificateChainFile "/path/to/ca-bundle.crt"
#
#     # Modern SSL configuration
#     SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
#     SSLCipherSuite HIGH:!aNULL:!MD5
#     SSLHonorCipherOrder on
#
#     <Directory "C:/xampp/htdocs/auditorias/public">
#         AllowOverride All
#         Require all granted
#         Options -Indexes +FollowSymLinks
#     </Directory>
#
#     # Same security restrictions as HTTP
#     <Directory "C:/xampp/htdocs/auditorias/app">
#         Require all denied
#     </Directory>
#     <Directory "C:/xampp/htdocs/auditorias/writable">
#         Require all denied
#     </Directory>
#     <Directory "C:/xampp/htdocs/auditorias/vendor">
#         Require all denied
#     </Directory>
#
#     ErrorLog "C:/xampp/apache/logs/auditorias-ssl-error.log"
#     CustomLog "C:/xampp/apache/logs/auditorias-ssl-access.log" combined
# </VirtualHost>

# ============================================================
# Quick Verification Commands
# ============================================================
#
# Test configuration syntax:
#   Linux: sudo apachectl configtest
#   Windows (XAMPP): httpd -t
#
# Restart Apache:
#   Linux: sudo systemctl restart apache2
#   Windows (XAMPP): Restart from XAMPP Control Panel
#
# Test endpoint:
#   curl http://auditorias.local/health
#   Expected: {"status":"ok","timestamp":"2025-01-16 10:30:00"}
#
# ============================================================
